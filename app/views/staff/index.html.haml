.container
  .row
    .panel.panel-default#header
      .panel-body
        .page-header
          %h1
            А мы тут стримами балуемся,
            =@session["name"]
        .page-body
          Здесь находится пока нихуя, работаю над этим.
    .row.notifications.center-block#flash
      = bootstrap_flash
    .col-md-3#tweet-panel
      .panel.panel-default
        .panel-body
          %h4.text-danger Последние 10 Твитов
          - if @session["streamer"] == "1" || @session["gmod"] == "1"
            =bootstrap_form_for @tweet, :url => url_for(:action => 'tweet', :controller => 'tweets'), :method => 'post' do |f|
              = f.check_box :tipe, input_html: {id: "ttype", :checked => false}, label: "Свое сообщение?"
              = f.text_area :comment, input_html: { maxlength: 140, :rows => 5, cols: 45, id: "tweettext" },  :include_blank => false, label: "Твит"
              %h3#count.text-success 99
              = f.submit "Твитнуть!", class: "btn btn-success"
        %ul.list-group
          - if !@tweets.empty?
            - @tweets.each do |tweet|
              .list-group-item
                %b.text-success= tweet.author
                %b :
                = tweet.comment
          - else
            %b.text-warning А твитов-то и нет!
    .col-md-9
      .panel.panel-default
        .panel-header
          %ul.nav.nav-pills{role: "tablist", id: "tabs"}
            %li{:role => "presentation", :class => "active"}
              %a{"data-toggle" => "tab", href: "#key", role: "tab"} Ваш Ключ
            %li{:role => "presentation"}
              %a{"data-toggle" => "tab", href: "#streams", role: "tab"} Каналы
            %li{:role => "presentation"}
              %a{"data-toggle" => "tab", href: "#keys-guest", role: "tab"} Гости
            %li{:role => "presentation"}
              %a{"data-toggle" => "tab", href: "#keys-streamers", role: "tab"} Стримеры
            - if @session["gmod"] == "1"
              %li{:role => "presentation"}
                %a{"data-toggle" => "tab", href: "#gmod", role: "tab"} Админка
            %li{class: "pull-right"}
              =link_to "Выход", logout_path
        .panel-body.tab-content
          #key.tab-pane.active
            %h1 Информация по ключам к стримам
            - if !@user_key.key.nil?
              .col-md-6
                %h3 Сменить настройки стрима
                Ничего сложного тут нет, просто настраиваете как сохраняется Ваш повтор. Поддержка фильмов СКОРО!
                %br
                Повтор
                %b ИГРЫ
                будет сохранен в виде
                .text-success Имя_стримера_-_Текущая_Игра_Дата.mp4
                = bootstrap_form_for @user_key, :url => url_for(:action => 'change_key', :controller => 'keys'), :method => 'post' do |f|
                  = f.text_field :game, required: true,  label: "Игра"
                  = f.text_field :movie, required: false,  label: "Кинцо"
                  = f.text_field :streamer, required: true,  label: "Имя стримера"
                  %br/
                  = f.submit "Сменить данные стрима", class: "btn btn-success"
            .col-md-6
              - if !@user_key.key.nil?
                %p Отмечу, что различаются два канала только по ссылке live (игра) и cinema (кино). То есть поле ключа можно не менять. Лучше иметь 2 разных профиля для obs и xsplit
                %h3
                  .text-info Игровой канал
                %b Ссылочка-писечка
                .text-success
                  rtmp://hd.omck.tv/live
                %br
                %b Далее в поле ключ (key) вставляем ваш ключ:
                %br
                .text-success
                  omcktv?key=#{@user_key.key}
                %h3
                  .text-info Кинцо-анимцо
                %b Ссылочка-писечка
                .text-success
                  rtmp://hd.omck.tv/cinema
                %br
                %b Далее в поле ключ (key) вставляем ваш ключ:
                .text-success
                  omcktv?key=#{@user_key.key}
              - elsif @session["streamer"] == "1" || @session["gmod"] == "1"
                %h3 Создать себе ключ
                %p У Вас есть права, значит вы можете стримить! Но ключа-то нет, так что создаем себе
                = bootstrap_form_for @user_key, :url => url_for(:action => 'make_key', :controller => 'keys'), :method => 'post' do |f|
                  = f.hidden_field :uid, required: true
                  = f.text_field :game, required: true,  label: "Игра"
                  = f.text_field :movie, required: false,  label: "Кинцо"
                  = f.text_field :streamer, required: true,  label: "Имя стримера"
                  %br/
                  = f.submit "Создать ключ", class: "btn btn-success"
          #streams.tab-pane
            = render 'channels/index'
          #keys-guest.tab-pane
            %h2 Ключики действующие (гостевые)
            - if @session["gmod"] == "1"
              .btn.btn-success#create-key-btn{onclick: "showKeyForm();"} Создать Ключ Для Гостя
              = bootstrap_form_for @key, html: {id: "create-key", style: "display: none;"}, :url => url_for(:action => 'make_key', :controller => 'keys'), :method => 'post' do |f|
                = f.hidden_field :guest, required: true
                = f.text_field :game, required: true,  label: "Игра"
                = f.text_field :movie, required: false,  label: "Кинцо"
                = f.text_field :streamer, required: true,  label: "Имя стримера"
                %br/
                = f.submit "Создать ключ", class: "btn btn-success"
              %br
              :javascript
                function showKeyForm() {
                  $("#create-key").show();
                  $("#create-key-btn").hide();
                };
              %br
            %table.table
              %tbody
                %tr
                %td
                %td
                  %b Имя
                %td
                  %b Игра
                %td
                  %b Фильм
                %td
                  %b Действителен до
                %td
                  %b Создан
                - if @session["gmod"] == "1"
                  %td
                    %b Действо
                - @keys_guests.each_with_index do |key, i|
                  %tr
                    %td= i+1
                    %td= key.streamer
                    %td= key.game
                    %td= key.movie
                    %td= key.expires
                    %td= key.created_at.strftime("%Y-%m-%d")
                    - if @session["gmod"] == "1"
                      %td
                        = link_to "Удалить", home_expire_key_path(id: key.id), method: "post"
          #keys-streamers.tab-pane
            %h2 Ключики действующие (стримеров)
            - if @session["gmod"] == "1"
              .btn.btn-success#create-streamer-btn{onclick: "showStreamerForm();"} Создать Ключ Для Стримера
              = bootstrap_form_for @new_streamer, html: {id: "create-streamer", style: "display: none;"}, :url => url_for(:action => 'manage_perm', :controller => 'users'), :method => 'post' do |f|
                = f.text_field :screen_name, required: true,  label: "Никнейм стримера (вписывать без @)"
                %br/
                = f.submit "Дать права", class: "btn btn-success"
              %br
              :javascript
                function showStreamerForm() {
                  $("#create-streamer").show();
                  $("#create-streamer-btn").hide();
                };
              %br
            %table.table
              %tbody
                %tr
                %td
                %td
                  %b Имя
                %td
                  %b Игра
                %td
                  %b Фильм
                %td
                  %b Действителен до
                %td
                  %b Создан
                - @keys_streamers.each_with_index do |key, i|
                  %tr
                    %td= i+1
                    %td= key.streamer
                    %td= key.game
                    %td= key.movie
                    %td= key.expires
                    %td= key.created_at.strftime("%Y-%m-%d")
                    - if @session["gmod"] == "1"
                      %td
                        = link_to "Испарить ключ", home_expire_key_path(id: key.id), method: "post"
          - if @session["id"] == "1" || @session["id"] == "2"
            #gmod.tab-pane
              %h2 Админка
              %table.table
                %tbody
                  %tr
                  %td
                    %b Имя
                  %td
                    %b Стример
                  %td
                    %b Админ
                  %td
                    %b Twitter
                  - @users.each do |user|
                    %tr
                      %td= user.name
                      %td
                        - if user.streamer == 1
                          =link_to tag_label("Снять права", :danger), home_remove_streamer_path(user: {id: user.id}), method: "post"
                        - else
                          =link_to tag_label("Выдать права", :success), home_manage_perm_path(user: {screen_name: user.screen_name, streamer: 1, gmod: user.gmod}), method: "post"
                      %td
                        - if user.gmod == 1
                          =link_to tag_label("Снять права", :danger), home_manage_perm_path(user: {screen_name: user.screen_name, streamer: user.streamer, gmod: 0}), method: "post"
                        - else
                          =link_to tag_label("Выдать права", :success), home_manage_perm_path(user: {screen_name: user.screen_name, streamer: user.streamer, gmod: 1}), method: "post"
                      %td= link_to "@#{user.screen_name}", "http://twitter.com/#{user.screen_name}"
